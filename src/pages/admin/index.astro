---
import Layout from '../../layouts/Layout.astro';
import { getWorkshops } from '../../firebase.server';

const workshops = await getWorkshops();
---

<Layout title="Panel de Administración" description="Panel de administración de OFTE">
  <script type="module" is:inline>
    import { initializeApp } from "https://esm.sh/firebase/app";
    import { getAuth, onAuthStateChanged } from "https://esm.sh/firebase/auth";
    import { getFirestore, collection, getDocs } from "https://esm.sh/firebase/firestore";

    const firebaseConfig = {
      apiKey: "AIzaSyCgXe4yo_R-KvNblWygDFn3TQ5CIxyyexc",
      authDomain: "ofte-landing-unab.firebaseapp.com",
      projectId: "ofte-landing-unab",
      storageBucket: "ofte-landing-unab.firebasestorage.app",
      messagingSenderId: "76733059112",
      appId: "1:76733059112:web:2e9343a1229d124503a51d",
      measurementId: "G-XVTG14TKMD"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    async function loadInscriptionsCount() {
      try {
        const inscriptionsCollection = collection(db, "inscriptions");
        const inscriptionsSnapshot = await getDocs(inscriptionsCollection);
        const count = inscriptionsSnapshot.size;
        document.getElementById('inscriptions-count').textContent = `${count} inscripciones totales`;
      } catch (error) {
        console.error('Error al obtener inscripciones:', error);
        document.getElementById('inscriptions-count').textContent = 'Error al cargar';
      }
    }

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "/admin/login";
      } else {
        loadInscriptionsCount();
      }
    });
  </script>

  <section class="py-16 sm:py-20">
    <div class="mx-auto max-w-2xl px-4 sm:px-6 lg:max-w-7xl lg:px-8">
      <div class="flex flex-col gap-12">
        <div>
          <h1 class="text-4xl font-medium tracking-tight sm:text-5xl">Panel de Administración</h1>
          <p class="mt-4 text-lg text-primary-950/70 dark:text-primary-200/70">
            Gestiona los seminarios y las inscripciones
          </p>
        </div>

        <div class="grid gap-8 sm:grid-cols-2">
          <a
            href="/admin/workshops"
            class="bg-primary-500/10 dark:bg-primary-400/10 flex flex-col gap-4 rounded-3xl p-8 transition hover:bg-primary-500/20 dark:hover:bg-primary-400/20"
          >
            <h2 class="text-2xl font-medium">Seminarios</h2>
            <p class="text-primary-950/70 dark:text-primary-200/70">
              {workshops.length} seminarios activos
            </p>
            <div class="mt-auto">
              <span class="text-primary-600 dark:text-primary-400">Gestionar seminarios →</span>
            </div>
          </a>

          <a
            href="/admin/inscriptions"
            class="bg-primary-500/10 dark:bg-primary-400/10 flex flex-col gap-4 rounded-3xl p-8 transition hover:bg-primary-500/20 dark:hover:bg-primary-400/20"
          >
            <h2 class="text-2xl font-medium">Inscripciones</h2>
            <p id="inscriptions-count" class="text-primary-950/70 dark:text-primary-200/70">
              Cargando...
            </p>
            <div class="mt-auto">
              <span class="text-primary-600 dark:text-primary-400">Ver inscripciones →</span>
            </div>
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>